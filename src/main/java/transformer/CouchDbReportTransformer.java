package transformer;

import json.couchdb.FileReport;
import json.couchdb.Scan;

import java.util.Map;
import java.util.stream.Collectors;

public class CouchDbReportTransformer {

    public FileReport transformFileReport(model.FileReport fileReport) {
        return new FileReport(
                transformScans(fileReport.getScans()),
                fileReport.getScanId(),
                fileReport.getSha1(),
                fileReport.getResource(),
                fileReport.getResponseCode(),
                fileReport.getScanDate(),
                fileReport.getPermalink(),
                fileReport.getVerboseMessage(),
                fileReport.getTotal(),
                fileReport.getPositives(),
                fileReport.getSha256(),
                fileReport.getMd5()
        );
    }

    private Scan transformScan(model.Scan scan) {
        return new Scan(
                scan.isDetected(),
                scan.getVersion(),
                scan.getResult(),
                scan.getUpdate()
        );
    }

        private Map<String, Scan> transformScans(Map<String, model.Scan> scans) {
            if (scans == null) return null;
            return scans.entrySet()
                    .stream()
                    .collect(Collectors.toMap(
                            Map.Entry::getKey,
                            e -> transformScan(e.getValue())
                    ));
        }

}
